[TOC]
# 重构前准备（Raffi Krikorian）

##  背景与目标

  - 需要上级领导/团队支持且该项目确实需要重构（比如切换到flutter进行双端开发，或下一个业务中，性能或功能非常不好做/或者做不了。其中包括代码臃肿都集中于activity，可读性差、没有规范，维护性差、修改一个导致其他部分也要修改）
- 重构目标：提高代码质量即维护性好（可扩展，可读性），但最主要是不是为了业务需求。
  
##  团队或个人需要掌握的东西

  - 充分掌握业务流程（了解业务人员需求，并从非核心进行重构），了解当前架构（当前架构和新架构方案对比）

  - 编写针对业务的单元测试（测试分三种，单元测试，非界面测试/api测试，闭环业务测试（自带网络数据模拟且模拟的数据符合实际数据）），并且需要覆盖率支持（jenkins + sonar）

##  需要掌握的思想和流程

  - 重构前规范（包括代码规范，命名规范，需工具支持，例如alibaba插件），明确完成界限（规划哪些需要重构和重构完成的条件，重构的具体目标（例如性能提高多少，测试覆盖率达到多少，框架审查））。
  - 编程原则（单一原则）和设计模式
  - 重构不等于重写
- 做好非技术因素（客户影响 管理层偏好  商业利益），例如多端开发选择taro，但是你是滴滴的员工，你领导让你用chaleaon。
- 
  - 提前设计架构：

      - 例如mvvm或mvp（clean架构）基本根据业务进行选择，页面偏

      - 根据业务选择第三方框架（团队审核，管理好第三方，并且第三方重构过程导入需评审）

      -  git flow管理   代码审查  
 - 渐进式重构：自底向上或从上到底，迭代重构+单元测试。并且评估重构效果，及时作出策略调整，阶段性成果展示给领导。

# 重构中

1. 每周1,3,5会议。周1安排任务，周5总结任务并规划下周且需要总结经验并存档，避免新人和旧人离开导致断层，周三则讨论问题。并汇报给领导。

2. 一般是有新需求才进行重构，填写修改模块，交由测试进行测试。

3. 第三方框架：leakcarry  和  代码审查 gerrit （最好评审前代码工具扫码通过，jenkins测试覆盖率达标）

# 重构后 （阶段性）

1.首先总结工作的优点和缺点，奖励做的好的人，鼓励做的稍微不好的人，这时候就要请客了。

2.找做的好的人进行分享。

3.阶段性成果量化，跟业务变化进行关联。最好说明重构给团队带来了什么。例如bug变少了，性能提高了，效率变快了，功能变好用了。



